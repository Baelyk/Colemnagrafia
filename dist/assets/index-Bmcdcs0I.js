(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=e(l);fetch(l.href,s)}})();async function nt(n,t={},e){return window.__TAURI_INTERNALS__.invoke(n,t,e)}function lt(n,t=!1){return window.__TAURI_INTERNALS__.transformCallback(n,t)}async function P(n,t={},e){return window.__TAURI_INTERNALS__.invoke(n,t,e)}var G;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WEBVIEW_CREATED="tauri://webview-created",n.FILE_DROP="tauri://file-drop",n.FILE_DROP_HOVER="tauri://file-drop-hover",n.FILE_DROP_CANCELLED="tauri://file-drop-cancelled"})(G||(G={}));async function et(n,t){await P("plugin:event|unlisten",{event:n,eventId:t})}async function K(n,t,e){const o=typeof(e==null?void 0:e.target)=="string"?{kind:"AnyLabel",label:e.target}:(e==null?void 0:e.target)??{kind:"Any"};return P("plugin:event|listen",{event:n,target:o,handler:lt(t)}).then(l=>async()=>et(n,l))}class C{constructor(t){this.path=t}async set(t,e){return await P("plugin:store|set",{path:this.path,key:t,value:e})}async get(t){return await P("plugin:store|get",{path:this.path,key:t})}async has(t){return await P("plugin:store|has",{path:this.path,key:t})}async delete(t){return await P("plugin:store|delete",{path:this.path,key:t})}async clear(){return await P("plugin:store|clear",{path:this.path})}async reset(){return await P("plugin:store|reset",{path:this.path})}async keys(){return await P("plugin:store|keys",{path:this.path})}async values(){return await P("plugin:store|values",{path:this.path})}async entries(){return await P("plugin:store|entries",{path:this.path})}async length(){return await P("plugin:store|length",{path:this.path})}async load(){return await P("plugin:store|load",{path:this.path})}async save(){return await P("plugin:store|save",{path:this.path})}async onKeyChange(t,e){return await K("store://change",o=>{o.payload.path===this.path&&o.payload.key===t&&e(o.payload.value)})}async onChange(t){return await K("store://change",e=>{e.payload.path===this.path&&t(e.payload.key,e.payload.value)})}}const d={yellow:"gold",darkyellow:"goldenrod",black:"black",gray:"lightgray",darkgray:"darkgray",red:"red",white:"white"},h={default:"sans-serif",word:"JetBrains Mono, sans-serif"},i={smallestDimension:n=>n.height/n.width<=1.75?n.height/1.75:Math.min(n.width,n.height),big:n=>i.smallestDimension(n)/7,medium:n=>i.smallestDimension(n)/10,small:n=>i.smallestDimension(n)/15,tiny:n=>i.smallestDimension(n)/25,teeny:n=>i.smallestDimension(n)/90};window.addEventListener("DOMContentLoaded",async()=>{const n=ot();if(n==null){console.error("Error initializing game");return}console.debug(n);try{await Z(n)}catch(t){console.error("Puzzle generation failed"),console.debug(t),n.errorText=JSON.stringify(t)}window.addEventListener("click",t=>{n.mouseX=t.clientX*n.scaling,n.mouseY=t.clientY*n.scaling,n.mouseDown=!0,n.wordMessage=null,window.requestAnimationFrame(e=>y(e,n))}),window.addEventListener("mousemove",t=>{n.mouseX=t.clientX*n.scaling,n.mouseY=t.clientY*n.scaling,n.mouseDown=!1,window.requestAnimationFrame(e=>y(e,n))}),window.addEventListener("resize",()=>{V(n,window.innerWidth,window.innerHeight),window.requestAnimationFrame(t=>y(t,n))}),window.addEventListener("wheel",t=>{n.wordlistIsOpen&&(n.wordlistScroll+=t.deltaY),n.hintsOpen&&(n.hintsScroll+=t.deltaY),window.requestAnimationFrame(e=>y(e,n))}),window.addEventListener("pointermove",t=>{t.pointerType==="mouse"&&t.pressure<.5||(n.wordlistIsOpen&&(n.wordlistScroll-=t.movementY,n.wordlistScrollSpeed=t.movementY,n.wordlistUserIsScrolling=!0),n.hintsOpen&&(n.hintsScroll-=t.movementY,n.hintsScrollSpeed=t.movementY,n.hintsUserIsScrolling=!0),window.requestAnimationFrame(e=>y(e,n)))}),window.addEventListener("pointerup",t=>{n.wordlistIsOpen&&(n.wordlistUserIsScrolling=!1),n.hintsOpen&&(n.hintsUserIsScrolling=!1),window.requestAnimationFrame(e=>y(e,n))}),window.requestAnimationFrame(t=>y(t,n))});function V(n,t,e){const o=window.devicePixelRatio;if(n.tagName==="game"){const l=n;l.width=t,l.height=e,l.scaling=o,l.ctx.canvas.style.width=`${t}px`,l.ctx.canvas.style.height=`${e}px`,l.ctx.canvas.width=t*o,l.ctx.canvas.height=e*o,l.ctx.scale(o,o)}else{const l=n;l.style.width=`${t}px`,l.style.height=`${e}px`,l.width=t*o,l.height=e*o;const s=l.getContext("2d");if(s==null)throw new Error("Unable to get canvas context");s.scale(o,o)}return{scaling:o,width:t,height:e}}function ot(){console.log("Initializing...");const n=document.querySelector("canvas");if(n==null)throw console.error("Unable to get canvas"),new Error("Unable to get canvas");const t=n.getContext("2d");if(t==null)throw console.error("Unable to get canvas context"),new Error("Unable to get canvas context");const{scaling:e,width:o,height:l}=V(n,window.innerWidth,window.innerHeight);return{width:o,height:l,scaling:e,ctx:t,tagName:"game",errorText:null,puzzle:{letters:[],words:{},pangrams:[],maxScore:0,word:"",found:[],score:0},mouseX:-1,mouseY:-1,mouseDown:!1,clickedHex:null,clickedHexTime:null,wordMessage:null,wordlistIsOpen:!1,wordlistToggleTime:null,wordlistScroll:0,wordlistScrollSpeed:0,wordlistUserIsScrolling:!1,menuOpen:!1,hintsOpen:!1,hintsHeight:0,hintsPuzzle:{pangrams:0,lengths:new Map,starts:new Map},hintsFound:{pangrams:0,lengths:new Map,starts:new Map},hintsScroll:0,hintsScrollSpeed:0,hintsUserIsScrolling:!1}}async function it(n){console.log("Saving puzzle state");const t=new C("store.dat");await t.set("puzzle",n.puzzle),await t.set("hints-puzzle",U(n.hintsPuzzle)),await t.set("hints-found",U(n.hintsFound)),await t.save()}async function st(n){console.log("Saving puzzle to web storage"),window.localStorage.setItem("puzzle",JSON.stringify(n.puzzle)),window.localStorage.setItem("hints-puzzle",JSON.stringify(U(n.hintsPuzzle))),window.localStorage.setItem("hints-found",JSON.stringify(U(n.hintsFound)))}async function B(n){window.__TAURI__?it(n):st(n)}function Q(n){const t={pangrams:0,lengths:new Map,starts:new Map},e={pangrams:0,lengths:new Map,starts:new Map};t.pangrams=n.pangrams.length;const o=Math.max(...Object.keys(n.words).map(l=>l.length));for(const l of[...n.letters].sort())t.lengths.set(l.toLowerCase(),Array(o+1).fill(0)),e.lengths.set(l.toLowerCase(),Array(o+1).fill(0));for(const l of Object.values(n.words).flat()){(t.lengths.get(l[0])??[])[l.length]+=1;const s=l.substring(0,2),r=t.starts.get(s)??0;t.starts.set(s,r+1),e.starts.set(s,0)}return[t,e]}function U(n){return{pangrams:n.pangrams,lengths:Array.from(n.lengths.entries()),starts:Array.from(n.starts.entries())}}function N(n){return{pangrams:n.pangrams,lengths:new Map(n.lengths),starts:new Map(n.starts)}}async function rt(n){if(window.__TAURI__==null)return console.error("Unable to load puzzle from Store outside of Tauri"),null;const t=new C("store.dat");let e=null,o=null,l=null,s=null;try{console.log("Loading puzzle..."),e=await t.get("puzzle"),o=await t.get("puzzle-date"),l=await t.get("hints-puzzle"),s=await t.get("hints-found")}catch(r){console.error("Failed to get stored data:"),console.error(r)}return o==null||o!==n||e==null||l==null||s==null?null:(console.debug(`Loaded stored puzzle state from ${o}`),console.debug(e),console.log("Stored puzzle is from today, using it"),{puzzle:e,hintsPuzzle:N(l),hintsFound:N(s)})}async function ct(n){console.log("Loading puzzle from web storage");const t=window.localStorage.getItem("puzzle"),e=window.localStorage.getItem("hints-puzzle"),o=window.localStorage.getItem("hints-found");if(t==null||e==null||o==null)return null;const l=JSON.parse(t),s=N(JSON.parse(e)),r=N(JSON.parse(o));return{puzzle:l,hintsPuzzle:s,hintsFound:r}}async function ut(n){return window.__TAURI__?await rt(n):await ct()}async function dt(n){const t="puzzles.json",e=new Request(t),l=await(await fetch(e)).json();return console.log(l),{letters:l.letters.map(s=>s.toUpperCase()),words:l.words,pangrams:l.pangrams,maxScore:Object.values(l.words).flat().reduce((s,r)=>s+q(r,l.pangrams),0),word:"",found:[],score:0}}async function xt(n){if(window.__TAURI__==null)return console.error("Unable to create daily puzzle outside of Tauri"),null;console.log("Creating a new daily puzzle...");try{const t=await nt("daily_puzzle");return await new C("store.dat").set("puzzle-date",n),{letters:t.letters.map(o=>o.toUpperCase()),words:t.words,pangrams:t.pangrams,maxScore:Object.values(t.words).flat().reduce((o,l)=>o+q(l,t.pangrams),0),word:"",found:[],score:0}}catch(t){console.error("Failed to create daily puzzle:"),console.error(t)}return null}async function ft(n){return window.__TAURI__?await xt(n):await dt()}async function Z(n,t){const e=new Date(Date.now()).toDateString();if(t==null){const l=await ut(e);if(l!=null){const{puzzle:s,hintsPuzzle:r,hintsFound:x}=l;n.puzzle=s,n.hintsPuzzle=r,n.hintsFound=x,console.log("Successfully loaded puzzle");return}}console.log("Failed to load puzzle, attempting to create puzzle");const o=await ft(e);if(o==null){n.errorText="Failed to create new daily puzzle";return}n.puzzle=o,[n.hintsPuzzle,n.hintsFound]=Q(n.puzzle),console.log(n.hintsPuzzle),B(n)}async function ht(n){n.puzzle.word="",n.puzzle.found=[],n.puzzle.score=0,[,n.hintsFound]=Q(n.puzzle),B(n)}function y(n,t){if(t.ctx.clearRect(0,0,t.width,t.height),t.errorText!=null){wt(n,t);return}if(t.puzzle.letters.length===0){pt(n,t);return}if(zt(n,t),t.menuOpen||t.hintsOpen)return;const e=St(n,t);t.puzzle.word+=e,bt(n,t),Pt(n,t),$t(n,t),It(n,t)}function wt(n,t){console.log("Error"),t.ctx.font=`bold ${i.big(t)}px ${h.default}`,t.ctx.textAlign="left",t.ctx.textBaseline="middle",t.ctx.fillStyle=d.black,t.ctx.fillText("Error",i.small(t),i.small(t)),t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.fillText(t.errorText||"Unknown error",i.small(t),2*i.small(t)+i.big(t))}function pt(n,t){console.log("Loading..."),window.requestAnimationFrame(o=>y(o,t)),t.ctx.font=`bold ${i.big(t)}px ${h.default}`,t.ctx.textAlign="left",t.ctx.textBaseline="middle";const e=".".repeat(n/250%4);t.ctx.fillText(`Loading${e}`,t.width/2-t.ctx.measureText("Loading...").width/2,t.height/2)}function zt(n,t){const e=i.tiny(t),o=i.tiny(t),l=i.small(t),s=t.width-l-o,r=i.teeny(t)/2,x=3*4*r;at(n,t,e,l,s,r,x),!t.menuOpen&&(yt(n,t,e,o,x,s),t.hintsOpen)}function at(n,t,e,o,l,s,r){if(!t.menuOpen){t.ctx.beginPath();for(let x=0;x<3;x++)t.ctx.roundRect(l,e+s*1.5+4*x*s,o,s,i.tiny(t));t.ctx.fillStyle=d.black,t.ctx.fill(),t.ctx.beginPath(),t.ctx.rect(l,e,o,r),t.mouseDown&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&(t.mouseDown=!1,t.menuOpen=!0,window.requestAnimationFrame(x=>y(x,t)))}if(t.menuOpen){const x=t.width-2*i.small(t),u=(t.width-x)/2;t.ctx.font=`${i.small(t)}px ${h.default}`,t.ctx.textAlign="left",t.ctx.textBaseline="middle";const w=v(t.ctx,"A")+i.small(t),p=w+i.small(t),z=[["Restart",()=>{ht(t),t.menuOpen=!1,window.requestAnimationFrame(S=>y(S,t))}],["Daily Puzzle",()=>{Z(t,"daily"),t.menuOpen=!1,window.requestAnimationFrame(S=>y(S,t))}],["New Puzzle",()=>{}]],a=t.height/2-z.length*p;z.forEach(([S,c],E)=>{t.ctx.beginPath(),t.ctx.roundRect(u,a+p*E,x,w,i.teeny(t)),t.mouseDown&&t.ctx.isPointInPath(t.mouseX,t.mouseY)?(t.mouseDown=!1,c(),t.ctx.fillStyle=d.darkgray,window.requestAnimationFrame(b=>y(b,t))):t.ctx.fillStyle=d.white,t.ctx.fill(),t.ctx.strokeStyle=d.black,t.ctx.stroke(),t.ctx.fillStyle=d.black,t.ctx.fillText(S,u+i.small(t),a+w/2+p*E)}),t.mouseDown&&(t.mouseDown=!1,t.menuOpen=!1,window.requestAnimationFrame(S=>y(S,t)))}}function yt(n,t,e,o,l,s){const r=s-o-l,x=e;if(t.ctx.beginPath(),t.ctx.roundRect(r,x,l,l,i.teeny(t)),t.ctx.strokeStyle=d.black,t.hintsOpen?(t.ctx.lineWidth=2,t.ctx.fillStyle=d.yellow):(t.ctx.lineWidth=1,t.ctx.fillStyle=d.white),t.ctx.fill(),t.ctx.stroke(),t.mouseDown&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&(t.mouseDown=!1,t.hintsOpen=!t.hintsOpen,window.requestAnimationFrame(u=>y(u,t))),t.ctx.font=`bold ${i.tiny(t)}px ${h.word}`,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.fillStyle=d.black,t.ctx.fillText("?",r+l/2,x+l/2),t.hintsOpen){let u=i.teeny(t);t.ctx.fillStyle=d.black,t.ctx.textAlign="left",t.ctx.textBaseline="top";const w="hints";t.ctx.font=`bold ${i.medium(t)}px ${h.word}`,t.ctx.fillText("Hints",o,u),u+=v(t.ctx,w),t.ctx.beginPath(),t.ctx.rect(0,u,t.width,t.height),t.ctx.save(),t.ctx.clip(),u+=i.small(t),!t.hintsUserIsScrolling&&t.hintsScrollSpeed!==0?(t.hintsScroll-=t.hintsScrollSpeed,t.hintsScrollSpeed*=.97,Math.abs(t.hintsScrollSpeed)<.1&&(t.hintsScrollSpeed=0),window.requestAnimationFrame(f=>y(f,t))):t.hintsUserIsScrolling;const p=Math.max(0,t.hintsHeight-t.height);t.hintsScroll<0?(t.hintsScroll=0,t.hintsScrollSpeed=0):t.hintsScroll>p&&(t.hintsScroll=p,t.hintsScrollSpeed=0),u-=t.hintsScroll;const z=t.hintsPuzzle.pangrams-t.hintsFound.pangrams;let a="";z===0?a=`You found all the pangrams! There were ${t.hintsPuzzle.pangrams} in all.`:(z===1?a="There's one more pangram":a=`There are ${z} more pangrams`,t.hintsPuzzle.pangrams===1?a+=" and that's the only one.":a+=`, out of ${t.hintsPuzzle.pangrams} pangrams overall.`,t.hintsFound.pangrams===0&&(a+=" You haven't found any yet 😞.")),t.ctx.font=`${i.tiny(t)}px ${h.default}`;const S=Ot(t.ctx,a,o,u,t.width-o*2);u+=S+i.small(t);const c=i.medium(t);t.ctx.fillStyle=d.black,t.ctx.textAlign="left",t.ctx.textBaseline="top";const E="Remaining words";t.ctx.font=`bold ${i.small(t)}px ${h.word}`,t.ctx.fillText(E,o,u),u+=v(t.ctx,E)-c/2+i.teeny(t);const b=u;t.ctx.font=`${i.tiny(t)}px ${h.word}`,t.ctx.textAlign="center",t.ctx.textBaseline="middle";const M=[...t.puzzle.letters].sort();t.ctx.lineWidth=2,t.ctx.strokeStyle=d.gray,t.ctx.fillStyle=d.black,t.ctx.beginPath();const j=new Set;for(const f of Array.from(t.hintsPuzzle.lengths.values()))f.forEach((T,O)=>{T>0&&j.add(O)});const $=[...j].sort((f,T)=>f-T),X=Array($.length).fill(0),m=c*(M.length+2),k=i.small(t);t.ctx.textBaseline="top";for(let f=0;f<$.length;f++)t.ctx.fillText($[f].toString(),k+c/2+c*(f+1),b+c/2);t.ctx.fillText("To.",k+c/2+c*($.length+1),b+c/2),t.ctx.beginPath(),t.ctx.moveTo(k,b+c),t.ctx.lineTo(k+($.length+2)*c,b+c),t.ctx.stroke(),t.ctx.textBaseline="middle";let L=null;for(let f=0;f<7;f++){const T=M[f].toLowerCase();t.ctx.font=`${i.tiny(t)}px ${h.word}`,t.ctx.fillText(T.toUpperCase(),k+c/2,b+c/2+c*(f+1));const O=t.hintsPuzzle.lengths.get(T)??[],D=t.hintsFound.lengths.get(T)??[];t.ctx.font=`bold ${i.tiny(t)}px ${h.word}`,$.forEach((I,A)=>{const W=O[I]-(D[I]??0);X[A]+=W,W>0&&(t.ctx.beginPath(),t.ctx.roundRect(k+1+c*(A+1),b+2+c*(f+1),c-2,c-4,i.teeny(t)),t.ctx.isPointInPath(t.mouseX,t.mouseY)?(L={letter:T,count:W},t.ctx.fillStyle=d.darkyellow):t.ctx.fillStyle=d.yellow,t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.fillText(W.toString(),k+c/2+c*(A+1),b+c/2+c*(f+1)))}),t.ctx.font=`${i.tiny(t)}px ${h.word}`;const H=O.reduce((I,A)=>I+A,0)-D.reduce((I,A)=>I+A,0);t.ctx.fillText((H||"").toString(),k+c/2+c*($.length+1),b+c/2+c*(f+1)),t.ctx.beginPath(),t.ctx.moveTo(k,b+c*(f+2)),t.ctx.lineTo(k+($.length+2)*c,b+c*(f+2)),t.ctx.stroke()}t.ctx.font=`${i.tiny(t)}px ${h.word}`;for(let f=-1;f<$.length;f++)t.ctx.fillText((f===-1?"To.":X[f]).toString(),k+c/2+c*(f+1),b+c/2+c*(M.length+1));const tt=X.reduce((f,T)=>f+T,0);t.ctx.fillText((tt||"").toString(),k+c/2+c*($.length+1),b+c/2+c*(M.length+1)),t.ctx.beginPath(),t.ctx.moveTo(k,b+c*(M.length+2)),t.ctx.lineTo(k+($.length+2)*c,b+c*(M.length+2)),t.ctx.stroke(),u+=m+i.small(t),t.ctx.fillStyle=d.black,t.ctx.textAlign="left",t.ctx.textBaseline="top";const J="Remaining starts";t.ctx.font=`bold ${i.small(t)}px ${h.word}`,t.ctx.fillText(J,o,u),u+=v(t.ctx,J)+i.teeny(t),t.ctx.textAlign="center",t.ctx.textBaseline="middle";const R=i.small(t);let _=0;for(const[f,T]of t.hintsPuzzle.starts.entries()){const O=t.hintsFound.starts.get(f),D=T-(O??0);if(D===0)continue;R+c*(_+2)>t.width-i.small(t)&&(u+=c+i.tiny(t),_=0),t.ctx.beginPath(),t.ctx.moveTo(R+i.teeny(t)+c*_,u+c),t.ctx.lineTo(R+c*(_+2),u+c),t.ctx.strokeStyle=d.gray,t.ctx.stroke(),t.ctx.font=`${i.tiny(t)}px ${h.word}`,t.ctx.fillText(f.toUpperCase(),R+c/2+c*_,u+c/2),t.ctx.beginPath(),t.ctx.roundRect(R+1+c*(_+1),u+2,c-2,c-4,i.teeny(t)),t.ctx.isPointInPath(t.mouseX,t.mouseY)?(L={letter:f,count:D},t.ctx.fillStyle=d.darkyellow):t.ctx.fillStyle=d.yellow,t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.font=`bold ${i.tiny(t)}px ${h.word}`,t.ctx.fillText(D.toString(),R+c/2+c*(_+1),u+c/2),_+=2}if(u+=c+i.tiny(t)+i.small(t),t.hintsHeight=u+t.hintsScroll,L!=null){const f=i.big(t),T=t.height-f-i.tiny(t),O=t.width-2*i.big(t),D=t.width/2-O/2;t.ctx.beginPath(),t.ctx.roundRect(D,T,O,f,i.teeny(t)),t.ctx.fillStyle=d.white,t.ctx.strokeStyle=d.black,t.ctx.lineWidth=1,t.ctx.fill(),t.ctx.stroke();const{letter:H,count:I}=L,A=`There ${I===1?"is":"are"} ${I} more word${I===1?"":"s"}`,W=`that start${I===1?"s":""} with ${H.toUpperCase()}.`;t.ctx.fillStyle=d.black,t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.textAlign="center",t.ctx.textBaseline="bottom",t.ctx.fillText(A,t.width/2,T+f/2),t.ctx.textBaseline="top",t.ctx.fillText(W,t.width/2,T+f/2)}t.ctx.restore()}}function St(n,t){let e="";const o=i.big(t);t.ctx.font=`bold ${o}px ${h.word}`,t.ctx.textAlign="center",t.ctx.textBaseline="middle";const l=t.width/2,s=t.height-o*4.5;if(Y(t.ctx,l,s,o),t.ctx.fillStyle=d.yellow,!t.wordlistIsOpen&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&t.mouseDown&&(t.mouseDown=!1,t.clickedHex=0,t.clickedHexTime=n,e=t.puzzle.letters[0],t.ctx.fillStyle=d.darkyellow),t.clickedHex===0&&t.clickedHexTime!=null){let w=(n-t.clickedHexTime)/200;if(w<1){w>.5&&(w=1-w),window.requestAnimationFrame(z=>y(z,t));const p=(1-w)*o+w*(.8*o);Y(t.ctx,l,s,p)}else t.clickedHex=null,t.clickedHexTime=null}t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.fillText(t.puzzle.letters[0],l,s);const r=2*Math.PI/6,x=1.9*o;for(let u=1;u<=6;u++){const w=l+Math.cos(r*u+r/2)*x,p=s+Math.sin(r*u+r/2)*x;if(Y(t.ctx,w,p,o),t.ctx.fillStyle=d.gray,!t.wordlistIsOpen&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&t.mouseDown&&(t.mouseDown=!1,t.clickedHex=u,t.clickedHexTime=n,e=t.puzzle.letters[u],t.ctx.fillStyle=d.darkgray),t.clickedHex===u&&t.clickedHexTime!=null){let a=(n-t.clickedHexTime)/200;if(a<1){a>.5&&(a=1-a),window.requestAnimationFrame(c=>y(c,t));const S=(1-a)*o+a*(.8*o);Y(t.ctx,w,p,S)}else t.clickedHex=null,t.clickedHexTime=null}t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.fillText(t.puzzle.letters[u],w,p)}return e}function bt(n,t){const e=t.height-i.big(t)*8,o=t.wordMessage??t.puzzle.word;let l=i.medium(t);t.ctx.font=`bold ${l}px ${h.word}`,t.ctx.textBaseline="middle",t.ctx.fillStyle=d.black;let s=t.ctx.measureText(o).width;for(;s>t.width*.75;)l=l*.95,t.ctx.font=`bold ${l}px ${h.word}`,s=t.ctx.measureText(o).width;if(t.wordMessage!=null){t.ctx.textAlign="center",t.ctx.fillStyle=d.darkgray,t.ctx.fillText(t.wordMessage,t.width/2,e);return}t.ctx.textAlign="left";let r=t.width/2-s/2;for(const x of t.puzzle.word)t.ctx.fillStyle=x===t.puzzle.letters[0]?d.yellow:d.black,t.ctx.fillText(x,r,e),r+=t.ctx.measureText(x).width}function Tt(n){return n.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")}function kt(n,t){const e=t.puzzle.word.toLowerCase();if(t.puzzle.word="",Object.hasOwn(t.puzzle.words,e))if(t.puzzle.found.map(Tt).includes(e))t.wordMessage="Already found";else{let o=0,l=0;for(const s of t.puzzle.words[e]){t.puzzle.found.unshift(s),l+=q(s,t.puzzle.pangrams),o+=1,g(s,t.puzzle.pangrams)&&(t.hintsFound.pangrams+=1),(t.hintsFound.lengths.get(s[0])??[])[s.length]+=1;const r=s.substring(0,2),x=t.hintsFound.starts.get(r)??0;t.hintsFound.starts.set(r,x+1)}t.puzzle.score+=l,t.wordMessage=`+${l/o}${o>1?` x${o}`:""}`,B(t)}else e.length<4?t.wordMessage="Too short":[...e].some(o=>o.toUpperCase()===t.puzzle.letters[0])?t.wordMessage="Not in word list":t.wordMessage="Missing center letter"}function Pt(n,t){const e=t.height-i.big(t),o=i.small(t),l=o*4,s=l*2+o+i.medium(t)*2;t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.strokeStyle=d.black;const r=t.width/2-s/2;t.ctx.beginPath(),t.ctx.roundRect(r,e-o,l,o*2,o),t.ctx.fillStyle=d.white,!t.wordlistIsOpen&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&t.mouseDown&&(t.mouseDown=!1,t.ctx.fillStyle=d.darkgray,t.puzzle.word=t.puzzle.word.substring(0,t.puzzle.word.length-1),window.requestAnimationFrame(u=>y(u,t))),t.ctx.lineWidth=1,t.ctx.stroke(),t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.fillText("Delete",r+l/2,e),t.ctx.beginPath(),t.ctx.arc(t.width/2,e,o,0,2*Math.PI),t.ctx.fillStyle=d.white,!t.wordlistIsOpen&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&t.mouseDown&&(t.mouseDown=!1,t.ctx.fillStyle=d.darkgray,t.puzzle.letters=t.puzzle.letters.map((u,w)=>({letter:u,sort:w===0?0:Math.random()})).sort((u,w)=>u.sort-w.sort).map(({letter:u})=>u),window.requestAnimationFrame(u=>y(u,t))),t.ctx.lineWidth=1,t.ctx.stroke(),t.ctx.fill();const x=t.width/2+s/2-l;t.ctx.beginPath(),t.ctx.roundRect(x,e-o,l,o*2,o),t.ctx.fillStyle=d.white,!t.wordlistIsOpen&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&t.mouseDown&&(t.mouseDown=!1,t.ctx.fillStyle=d.darkgray,kt(n,t),window.requestAnimationFrame(u=>y(u,t))),t.ctx.lineWidth=1,t.ctx.stroke(),t.ctx.fill(),t.ctx.fillStyle=d.black,t.ctx.fillText("Enter",x+l/2,e)}const F=[[0,"Beginner"],[.02,"Good Start"],[.05,"Moving Up"],[.08,"Good"],[.15,"Solid"],[.25,"Nice"],[.4,"Great"],[.5,"Amazing"],[.7,"Genius"],[1,"Queen Bee"]];function $t(n,t){const e=F.findIndex(([p,z])=>t.puzzle.score<Math.round(p*t.puzzle.maxScore))-1,o=t.width-2*i.tiny(t),l=t.width/2-o/2,s=3*i.small(t);t.ctx.font=`bold ${i.tiny(t)}px ${h.default}`;const r=i.tiny(t)+Math.max(...F.map(([p,z])=>t.ctx.measureText(z).width));let x=F[e][1];t.ctx.beginPath(),t.ctx.moveTo(l+r,s),t.ctx.lineTo(l+o,s),t.ctx.strokeStyle=d.gray,t.ctx.stroke(),t.ctx.textBaseline="middle";const u=(o-r-2*i.teeny(t))/(F.length-1);let w;for(let p=0;p<F.length;p++){const z=l+r+i.teeny(t)+p*u;let a=i.teeny(t);p===e&&(a=i.tiny(t)),t.ctx.beginPath(),t.ctx.arc(z,s,i.tiny(t),0,2*Math.PI),w===void 0&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&(w=!0,a=i.tiny(t)),p<=e?t.ctx.fillStyle=d.yellow:t.ctx.fillStyle=d.gray,t.ctx.beginPath(),t.ctx.arc(z,s,a,0,2*Math.PI),t.ctx.fill(),t.ctx.textAlign="center",t.ctx.fillStyle=d.black,w?(t.ctx.font=`${i.tiny(t)}px ${h.word}`,t.ctx.fillText(Math.round(t.puzzle.maxScore*F[p][0]).toString(),z,s),x=F[p][1]):p===e&&(t.ctx.font=`bold ${i.tiny(t)}px ${h.word}`,t.ctx.fillText(t.puzzle.score.toString(),z,s)),w&&(w=!1)}t.ctx.font=`bold ${i.tiny(t)}px ${h.default}`,t.ctx.textAlign="left",t.ctx.textBaseline="middle",t.ctx.fillStyle=d.black,t.ctx.fillText(x,l,s)}function It(n,t){const e=t.width-2*i.tiny(t),o=t.width/2-e/2,l=4*i.small(t),s=t.wordlistIsOpen?t.height-l-i.small(t):t.height/20;if(t.ctx.beginPath(),t.ctx.roundRect(o,l,e,s,i.teeny(t)),t.ctx.strokeStyle=d.black,t.ctx.fillStyle=d.white,t.ctx.fill(),t.ctx.stroke(),t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.textAlign="left",t.ctx.textBaseline="middle",t.wordlistIsOpen){t.ctx.save(),t.ctx.clip(),t.ctx.font=`bold ${i.tiny(t)}px ${h.default}`;const r=v(t.ctx,"A")*2;!t.wordlistUserIsScrolling&&t.wordlistScrollSpeed!==0?(t.wordlistScroll-=t.wordlistScrollSpeed,t.wordlistScrollSpeed*=.97,Math.abs(t.wordlistScrollSpeed)<.1&&(t.wordlistScrollSpeed=0),window.requestAnimationFrame(S=>y(S,t))):t.wordlistUserIsScrolling;const x=Math.ceil(t.puzzle.found.length/2)+1;t.wordlistScroll=Math.min(Math.max(0,t.wordlistScroll),Math.max(0,(x+1)*r-s)),t.ctx.fillStyle=d.black;const u=l+r-t.wordlistScroll,w=o+i.tiny(t),p=o+e/2+i.tiny(t);let z=0;const a=[...t.puzzle.found].sort((S,c)=>S.localeCompare(c));t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.fillText(`${t.puzzle.found.length} word${z===1?"":"s"} found`,w,u);for(const S of a){t.ctx.font=`${t.puzzle.pangrams.includes(S)?"bold":""} ${i.tiny(t)}px ${h.default}`;const c=u+r*(Math.floor(z/2)+1);z%2===0?t.ctx.fillText(S,w,c):t.ctx.fillText(S,p,c),z++}t.ctx.beginPath(),t.ctx.moveTo(t.width/2,l+r/2),t.ctx.lineTo(t.width/2,l+s-r/2),t.ctx.strokeStyle=d.gray,t.ctx.stroke(),t.ctx.restore()}else t.wordlistScrollSpeed=0;if(!t.wordlistIsOpen){let r=0;const x=o+i.tiny(t),u=i.teeny(t);t.ctx.fillStyle=d.black,t.ctx.font=`${i.tiny(t)}px ${h.default}`;const w=t.ctx.measureText("...").width;for(const p of t.puzzle.found){t.ctx.font=`${t.puzzle.pangrams.includes(p)?"bold":""} ${i.tiny(t)}px ${h.default}`;const z=t.ctx.measureText(`${p}`).width;if(r+z+w+u>e-i.tiny(t)*2){t.ctx.font=`${i.tiny(t)}px ${h.default}`,t.ctx.fillText("...",x+r,l+s/2);break}t.ctx.fillText(p,x+r,l+s/2),r+=z+u}}t.ctx.beginPath(),t.ctx.roundRect(o,l,e,s,i.teeny(t)),t.mouseDown&&t.ctx.isPointInPath(t.mouseX,t.mouseY)&&(t.mouseDown=!1,t.wordlistIsOpen=!t.wordlistIsOpen,t.wordlistToggleTime=n,window.requestAnimationFrame(r=>y(r,t)))}function g(n,t){return t.includes(n)}function q(n,t){return n.length===4?1:n.length+(g(n,t)?7:0)}function Y(n,t,e,o){const s=2*Math.PI/6;n.beginPath(),n.moveTo(t+o,e);for(let r=1;r<=6;r++)n.lineTo(t+Math.cos(s*r)*o,e+Math.sin(s*r)*o)}function v(n,t){return n.measureText(t).fontBoundingBoxAscent+n.measureText(t).fontBoundingBoxDescent}function Ot(n,t,e,o,l){let s=0,r="";const x=t.split(" ");for(const u of x){if(n.measureText(r).width+n.measureText(`${u} `).width<=l){r+=`${u} `;continue}n.fillText(r,e,o+s),s+=v(n,r),r=`${u} `}return n.fillText(r,e,o+s),s+=v(n,r),s}
